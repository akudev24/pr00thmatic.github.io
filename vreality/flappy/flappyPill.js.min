(() => {var utils={lerp:function(e,t,i){var a=(1-i)*e+i*t,n=Math.max(e,t),s=Math.min(e,t);return Math.max(s,Math.min(n,a))},randomBetween:function(e,t){return(Math.max(e,t)-Math.min(e,t))*Math.random()+Math.min(e,t)},lerpedRange:function(e,t,i){return utils.lerp(e[0][t],e[1][t],i)},randomLerpedRange:function(e,t){return utils.randomBetween(utils.lerpedRange(e,0,t),utils.lerpedRange(e,1,t))}},Pill={gimmiePill:function(){var e={sprite:context.physics.add.image(200,config.height/2,"pildorita"),flap:function(){gameStatus.started=!0,e.sprite.body.velocity.y=gameStatus.getFlapVelocity()},update:function(){gameStatus.started||(e.sprite.body.velocity.y=0,e.sprite.y=config.height/2),e.sprite.body.y>config.height-gameSettings.floorLine?this.die():this.sprite.rotation=utils.lerp(-gameSettings.angle/360*Math.PI,gameSettings.angle/360*Math.PI,(gameSettings.velocityRange/2+this.sprite.body.velocity.y)/gameSettings.velocityRange)},die:function(){if(gameSettings.immortal)return context.cameras.main.shake(100),void console.log("CHEATER! YOU'D BE DEAD BY NOW >:C");gameStatus.emitter.off("update",e.update,e),context.input.off("pointerdown",e.flap,e),e.sprite.destroy(),e.sprite=null,setTimeout(()=>{game.scene.pause("flappyPills")},200),setTimeout(()=>{game.scene.resume("flappyPills"),gameStatus.emitter.emit("game over")},1500),context.cameras.main.shake(100)}};return gameStatus.pill=e,context.input.on("pointerdown",e.flap,e),gameStatus.emitter.on("update",e.update,e),e}},Pipe={group:null,create:function(){this.group=context.physics.add.staticGroup()},gimmiePipe:function(){var e={sprite:this.group.create(gameSettings.pipeSpawnX(),config.height/2+utils.randomBetween(gameSettings.pipeSpawnOffsetY[0],gameSettings.pipeSpawnOffsetY[1]),"pipes"),scored:!1,update:function(){this.sprite.x-=gameStatus.deltaTime*gameStatus.getXSpeed(),this.sprite.x<-192?this.die():gameStatus.pill&&gameStatus.pill.sprite&&(!this.scored&&this.sprite.x<200&&(this.scored=!0,gameStatus.score++,gameStatus.emitter.emit("score change")),this.sprite.x>0&&this.sprite.x<400&&(gameStatus.pill.sprite.y<this.sprite.y+225&&gameStatus.pill.sprite.y>this.sprite.y-225||gameStatus.pill.die()))},die:function(){this.sprite.destroy(),this.sprite=null,gameStatus.emitter.off("update",e.update,e)}};return gameStatus.emitter.on("update",e.update,e),context.physics.add.collider(gameStatus.pill,Pipe.group),e}},gameSettings={waitForInputToStart:!0,scalingDifficulty:!0,unscaledGravity:4410,unscaledXSpeed:1188,maxScoreToHardest:30,xSpeed:[640,1188],gravityRange:[1470,4410],immortal:!1,distanceBetweenPipes:900,flapHeight:150,pipeSpawnOffsetY:[-421,249],uiDepth:1e3,tileSize:64,floorLine:200,angle:80,velocityRange:1e3,pipeSpawnX:function(){return config.width+192}},gameStatus=null;function resetGameStatus(){gameStatus={started:!1,pill:null,gameOver:!1,score:0,pipeSpawnCooldown:2,getXSpeed:function(){return gameSettings.scalingDifficulty?utils.lerp(gameSettings.xSpeed[0],gameSettings.xSpeed[1],this.score/gameSettings.maxScoreToHardest):gameSettings.unscaledXSpeed},getGravity:function(){return gameSettings.scalingDifficulty?utils.lerp(gameSettings.gravityRange[0],gameSettings.gravityRange[1],this.score/gameSettings.maxScoreToHardest):gameSettings.unscaledGravity},getFlapVelocity:function(){return-Math.sqrt(2*context.physics.world.gravity.y*gameSettings.flapHeight)}}}var context,images=["city","terrain-loopseamless","pildorita","pipes","background over","game over"],flappyPills=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"flappyPills"})},preload:function(){this.load.setBaseURL("assets");for(var e=0;e<images.length;e++)this.load.image(images[e])},create:function(){resetGameStatus(),gameSettings.waitForInputToStart||(gameStatus.started=!0),gameStatus.emitter=new Phaser.Events.EventEmitter,context=this,UI.create(),UI.isOver=!1;this.add.image(config.width/2,config.height-164,"city").setOrigin(.5,1).setDepth(-100);this.add.image(config.width/2,config.height/2,"background over").setDepth(200),gameStatus.floor=this.add.tileSprite(config.width/2,config.height,config.width,480,"terrain-loopseamless").setOrigin(.5,1).setDepth(100),Pipe.create(),Pill.gimmiePill(),gameStatus.emitter.on("game over",gameOver,this),gameStatus.emitter.on("score change",this.scoreChange,this),this.cameras.main.setBackgroundColor("#262262")},update:function(e,t){gameStatus.time=e/1e3,gameStatus.deltaTime=t/1e3,gameStatus.started&&(gameStatus.pipeSpawnCooldown-=gameStatus.deltaTime,gameStatus.pipeSpawnCooldown<=0&&(gameStatus.pipeSpawnCooldown=gameSettings.distanceBetweenPipes/gameStatus.getXSpeed(),Pipe.gimmiePipe())),gameStatus.emitter.emit("update"),gameStatus.floor.setTilePosition(gameStatus.floor.tilePositionX+gameStatus.deltaTime*gameStatus.getXSpeed()*1.5)},scoreChange:function(){context.physics.world.gravity.y=gameStatus.getGravity()}});function gameOver(){UI.createGameOver(),gameStatus.gameOver=!0}var config={type:Phaser.AUTO,width:1080,height:1800,physics:{default:"arcade",arcade:{gravity:{y:1470}}},scene:[flappyPills]},game=new Phaser.Game(config),UI={isOver:!1,frogCounterLabel:null,updateScore:function(){UI.frogCounterLabel.setText(" x "+gameStatus.score)},normalizedPos:function(e,t){return{x:config.width*e,y:config.height*t}},onOver:function(){UI.isOver=!0,this.originalColor=this.style.backgroundColor,this.style.backgroundColor="#999",this.setStyle(this.style)},onExit:function(){UI.isOver=!1,this.style.backgroundColor=this.originalColor,this.setStyle(this.style)},onAgain:function(){game.scene.start("flappyPills")},onRanking:function(){parent.location.href = "../../ranking.php";},destroyIndication:function(){UI.indication.destroy()},create:function(){UI.frogCounterLabel=context.add.text(192,64," x 0",{fontFamily:"Passion One",fontSize:"64px"}).setOrigin(0,0).setDepth(gameSettings.uiDepth-10).setScrollFactor(0),setTimeout(()=>UI.frogCounterLabel.setStyle(UI.style),1e3),gameStatus.emitter.on("score change",UI.updateScore,UI),UI.indication=context.add.text(config.width/2,400,"¡Toca para comenzar!",{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth-6),setTimeout(()=>UI.indication.setStyle(UI.indication.style),500),context.input.on("pointerdown",this.destroyIndication,UI)},createGameOver:function(){gameStatus.gameOver||(this.asfadsfasd=context.add.image(config.width/2,config.height/2,"game over").setDepth(gameSettings.uiDepth-1).setScrollFactor(0),UI.createLabel("game over label","¡Sigue intentando!",620,"#f68b1f"),UI.createLabel("score","x "+gameStatus.score,386),UI.createLabel("your ranking","Tu puntaje máximo\n"+backend.getPuntajeMaximo(gameStatus.score, UI),1246,null,"48px"),UI.createGameOverButton("again","Jugar de \nNuevo",790,0,UI.onOver,UI.onExit,UI.onAgain),UI.createGameOverButton("ranking","Ver \nRanking",1e3,0,UI.onOver,UI.onExit,UI.onRanking))},createGameOverButton:function(e,t,i,a,n,s,o){UI[e]=context.add.text(context.cameras.main.centerX+a,i,t,{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center",backgroundColor:"#602a7e"}).setOrigin(0==a?.5:Math.sign(a)<0?1:0,.5).setDepth(gameSettings.uiDepth).setPadding(64,16,64,16).setInteractive({useHandCursor:!0}).on("pointerover",n).on("pointerout",s).on("pointerdown",o).setScrollFactor(0)},createLabel:function(e,t,i,a="#602a7e",n="96px"){null===a&&(a="#602a7e"),UI[e]=context.add.text(context.cameras.main.centerX,i,t,{fontFamily:"Passion One",fontSize:n,color:a,align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth).setScrollFactor(0)}}; })();
