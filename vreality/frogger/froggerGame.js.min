(() => {var killer,utils={lerp:function(e,t,i){var a=(1-i)*e+i*t,n=Math.max(e,t),s=Math.min(e,t);return Math.max(s,Math.min(n,a))},randomBetween:function(e,t){return(Math.max(e,t)-Math.min(e,t))*Math.random()+Math.min(e,t)},lerpedRange:function(e,t,i){return utils.lerp(e[0][t],e[1][t],i)},randomLerpedRange:function(e,t){return utils.randomBetween(utils.lerpedRange(e,0,t),utils.lerpedRange(e,1,t))}},Frog={gimmieFroggy:function(){var e={sprite:scene.physics.add.sprite(config.width/2,gameSettings.originY*gameSettings.tileSize,"palta"),tileY:function(){return Math.round(this.sprite.y/gameSettings.tileSize)},tileX:function(){return Math.round(this.sprite.x/gameSettings.tileSize)},step:0,moveToTile:function(e,t){if((e||0===e)&&(this.sprite.x=gameSettings.tileSize*e+gameSettings.tileSize/2),t||0===t){this.sprite.scaleX*=-1,this.sprite.play("jump");scene.tweens.add({targets:this.sprite,y:gameSettings.tileSize*t,ease:"InOut",duration:100,onComplete:()=>{this.sprite&&this.sprite.play("idle")},onCompleteScope:this})}},froggyJump:function(){this.done||UI.isOver||(this.moveToTile(null,gameSettings.frogSteps[this.step++]),this.step>=gameSettings.frogSteps.length&&(scene.input.off("pointerdown",this.froggyJump,this),this.done=!0,gameStatus.rescuedFroggies++,setTimeout(()=>{this.destroy(),characters.frog=Frog.gimmieFroggy(),gameStatus.emitter.emit("score change")},1e3)))},destroy:function(){this.sprite.destroy(),this.sprite=null,scene.input.off("pointerdown",this.froggyJump,this)},die:function(){this.sprite&&(this.destroy(),gameStatus.emitter.emit("dead froggy"),scene.cameras.main.shake())},createSavedFroggy:function(){scene.add.image(gameStatus.rescuedFroggies*gameSettings.tileSize+(gameStatus.rescuedFroggies-1)*gameSettings.tileSize/2,gameSettings.frogWin*gameSettings.tileSize,"saved froggies").setOrigin(0,1)}};return e.sprite.play("idle"),e.sprite.setOrigin(.5,1),scene.input.on("pointerdown",e.froggyJump,e),e}},Car={};Car.gimmieCar=function(e,t){var i={isSlow:Math.random()<gameSettings.slowProbability,sprite:null,orientation:t,lane:e,speed:NaN,update:function(){this.sprite.x+=this.orientation*this.speed*(gameStatus.deltaTime/1e3),characters.frog&&characters.frog.sprite&&Phaser.Geom.Intersects.RectangleToRectangle(this.sprite.getBounds(),characters.frog.sprite.getBounds())&&(killer=this,characters.frog.die()),(this.sprite.x<-150||this.sprite.x>config.width+150)&&this.destroy()},destroy:function(){this.sprite.destroy(),this.sprite=null,gameStatus.emitter.off("update",i.update,i)}};i.speed=i.isSlow?utils.randomLerpedRange(gameSettings.slowCarSpeed,gameSettings.normalizedDifficulty()):utils.randomLerpedRange(gameSettings.fastCarSpeed,gameSettings.normalizedDifficulty());var a=Math.random()>.5?"1":"2";return i.sprite=scene.physics.add.image(1==t?-100:config.width+100,gameSettings.tileSize*gameSettings.lanes[2*e+(1===t?0:1)]-5*t,i.isSlow?"bus"+a:"car"+a),i.sprite.scaleX*=t,i.sprite.setOrigin(.5,1),gameStatus.emitter.on("update",i.update,i),i};var UI={isOver:!1,frogCounterLabel:null,updateScore:function(){UI.frogCounterLabel.setText(" x "+gameStatus.rescuedFroggies)},normalizedPos:function(e,t){return{x:config.width*e,y:config.height*t}},onOver:function(){UI.isOver=!0,this.originalColor=this.style.backgroundColor,this.style.backgroundColor="#999",this.setStyle(this.style)},onExit:function(){UI.isOver=!1,this.style.backgroundColor=this.originalColor,this.setStyle(this.style)},onAgain:function(){game.scene.start("froggerGame")},onRanking:function(){window.open("ranking")},destroyIndication:function(){UI.indication.destroy()},create:function(){UI.frogCounterLabel=scene.add.text(192,64," x 0",{fontFamily:"Passion One",fontSize:"64px",color:"#812990"}).setOrigin(0,0).setDepth(gameSettings.uiDepth-5),setTimeout(()=>UI.frogCounterLabel.setStyle(UI.style),500),gameStatus.emitter.on("score change",UI.updateScore,UI),UI.indication=scene.add.text(config.width/2,400,"¡Toca para comenzar!",{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth-6),setTimeout(()=>UI.indication.setStyle(UI.indication.style),500),scene.input.on("pointerdown",this.destroyIndication,UI)},createGameOver:function(){scene.add.image(config.width/2,config.height/2,"game over").setDepth(gameSettings.uiDepth-1),UI.createLabel("game over label","¡Sigue intentando!",620,"#f68b1f"),UI.createLabel("score","x "+gameStatus.rescuedFroggies,386),UI.createLabel("your ranking","Tu puntaje máximo\n"+backend.getPuntajeMaximo(gameStatus.score),1246,null,"48px"),UI.createGameOverButton("again","Jugar de \nNuevo",790,0,UI.onOver,UI.onExit,UI.onAgain),UI.createGameOverButton("ranking","Ver \nRanking",1e3,0,UI.onOver,UI.onExit,UI.onRanking)},createGameOverButton:function(e,t,i,a,n,s,r){UI[e]=scene.add.text(scene.cameras.main.centerX+a,i,t,{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center",backgroundColor:"#602a7e"}).setOrigin(0==a?.5:Math.sign(a)<0?1:0,.5).setDepth(gameSettings.uiDepth).setPadding(64,16,64,16).setInteractive({useHandCursor:!0}).on("pointerover",n).on("pointerout",s).on("pointerdown",r)},createLabel:function(e,t,i,a="#602a7e",n="96px"){null===a&&(a="#602a7e"),UI[e]=scene.add.text(scene.cameras.main.centerX,i,t,{fontFamily:"Passion One",fontSize:n,color:a,align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth)}},gameSettings={normalizedDifficulty:function(){return gameStatus.rescuedFroggies/gameSettings.highestDifficulty},highestDifficulty:5,spawnCooldown:[[3,6],[1.5,3]],slowCarSpeed:[[300,400],[600,700]],fastCarSpeed:[[600,700],[900,1e3]],tileSize:64,originY:26,destinationY:4,lanes:[23.5,21,16.5,14,9.5,7],slowProbability:.7,uiDepth:500,frogSteps:[24,21.5,19,17,14.5,12,10,7.5,5],frogWin:2};function resetGameStatus(){gameStatus={rescuedFroggies:0,deltaTime:0,time:0}}var scene,gameStatus=null,characters={},images=["background","background over","frog","car1","car2","bus1","bus2","game over"],froggerGame=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"froggerGame"})},preload:function(){this.load.setBaseURL("assets");for(var e=0;e<images.length;e++)this.load.image(images[e]);this.load.spritesheet("palta","palta.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("ads","ads.png",{frameWidth:512,frameHeight:256})},create:function(){scene=this,resetGameStatus(),UI.isOver=!1,scene.anims.create({key:"idleAd",frames:scene.anims.generateFrameNumbers("ads",{frames:[0,1]}),frameRate:.1,repeat:-1}),this.add.image(0,0,"background").setOrigin(0,0),this.add.image(0,0,"background over").setDepth(gameSettings.uiDepth-1).setOrigin(0,0),this.add.sprite(560,250,"ads").setDepth(10).setOrigin(0,1).play("idleAd"),gameStatus.emitter=new Phaser.Events.EventEmitter,gameStatus.emitter.on("dead froggy",gameOver,this),gameStatus.deltaTime=0,gameStatus.time=Date.now(),scene.anims.create({key:"idle",frames:scene.anims.generateFrameNumbers("palta",{frames:[0,1,2,1,0]}),frameRate:16,repeat:-1}),scene.anims.create({key:"jump",frames:scene.anims.generateFrameNumbers("palta",{frames:[3]}),frameRate:16,repeat:-1}),characters.frog=Frog.gimmieFroggy(this);for(var e=0;e<gameSettings.lanes.length/2;e++)CarLane.getCarLane(e,1),CarLane.getCarLane(e,-1);UI.create()},update:function(){gameStatus.deltaTime=Date.now()-gameStatus.time,gameStatus.time=Date.now(),gameStatus.emitter.emit("update")}});function gameOver(){characters.frog=null,UI.createGameOver()}var CarLane={getCarLane:function(e,t){var i={orientation:t,lane:e,lastSpawnTime:-1,nextSpawnTime:-1,lastCar:null,update:function(){Date.now()>this.nextSpawnTime&&(this.reset(),this.lastCar=Car.gimmieCar(this.lane,this.orientation))},reset:function(){this.lastSpawnTime=Date.now(),this.nextSpawnTime=Date.now()+1e3*utils.randomLerpedRange(gameSettings.spawnCooldown,gameSettings.normalizedDifficulty())}};i.reset(),gameStatus.emitter.on("update",i.update,i),this.lastCar=Car.gimmieCar(i.lane,i.orientation),this.lastCar.sprite.x=Math.random()*config.width,i.nextSpawnTime-=this.lastCar.sprite.x/this.lastCar.speed*1e3}},config={type:Phaser.AUTO,width:1080,height:1800,physics:{default:"arcade",arcade:{gravity:{y:0}}},scene:[froggerGame]},game=new Phaser.Game(config);})();
