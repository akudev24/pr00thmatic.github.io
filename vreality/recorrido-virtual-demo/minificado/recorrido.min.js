var utils={registerOnClic:function(n,e){registerOnClicMesh(global.scene.getMeshByName(n),e)},registerOnClicMesh:function(n,e){n.actionManager||(n.actionManager=new BABYLON.ActionManager(global.scene)),n.actionManager.registerAction(utils.babylonAction(e))},babylonAction:function(n){return new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickTrigger,n)},lerp:function(n,e,t){return{x:utils.lerpScalar(n.x,e.x,t),y:utils.lerpScalar(n.y,e.y,t),z:utils.lerpScalar(n.z,e.z,t)}},lerpScalar:function(n,e,t){var r=Math.min(n,e),a=Math.max(n,e);return Math.max(r,Math.min(a,n+t*(e-n)))},equals:function(n,e){return n.x==e.x&&n.y==e.y&&n.z==e.z},toVector3:function(n){return new BABYLON.Vector3(n.x,n.y,n.z)},set:function(n,e){e.x=n.x,e.y=n.y,e.z=n.z}};
var sky=()=>{var e=BABYLON.MeshBuilder.CreateBox("skyBox",{size:1e3},global.scene),o=new BABYLON.StandardMaterial("skyBox",global.scene);o.backFaceCulling=!1,o.reflectionTexture=new BABYLON.CubeTexture("textures/skybox",global.scene),o.reflectionTexture.coordinatesMode=BABYLON.Texture.SKYBOX_MODE,o.diffuseColor=new BABYLON.Color3(0,0,0),o.specularColor=new BABYLON.Color3(0,0,0),e.material=o};
var cameras={currentCameraTarget:null,lastTarget:null,transitionElapsed:0,lerping:!0,initialPosition:{x:1.042682599999999,y:34.228874000000005,z:42.5818329},navpointOffset:{x:0,y:1.5,z:0},goToInitialPosition:function(){this.currentCameraTarget={position:this.initialPosition,rotation:global.cam.rotation,duration:2}},setup:function(){global.cam=new BABYLON.FreeCamera("camera1",utils.toVector3(cameras.initialPosition),global.scene),global.cam.rotation=new BABYLON.Vector3(.027,-3.577,0),global.cam.minZ=.1,global.cam.angularSensibility=5e3,global.cam.attachControl(document.getElementById("renderCanvas"),!0),this.goToInitialPosition(),this.lastTarget={position:global.cam.position.clone(),rotation:global.cam.rotation.clone(),duration:2},global.scene.registerBeforeRender(()=>{if(cameras.lerping){this.lastTarget!=this.currentCameraTarget&&(this.transitionElapsed=0,this.lastTarget=this.currentCameraTarget);var a=this.transitionElapsed/this.currentCameraTarget.duration;a=a>1?1:a;var t=utils.lerp(global.scene.cameras[0].position,this.currentCameraTarget.position,a);global.scene.cameras[0].position=utils.toVector3(t),this.transitionElapsed+=global.scene._engine._deltaTime/1e3}})}};
var colorPicker=(()=>{return{loops:{},pickColor:function(o){if(console.log("mesh: "+o.source.name+" mat: "+o.source.material.name),o.source.material){colorPicker.loops[o.source.material.name]=0|colorPicker.loops[o.source.material.name];var r=null;o.source.name.indexOf("wall")>=0&&(r=colorPicker.wallColors),(o.source.material.name.indexOf("floor")>=0||o.source.material.name.indexOf("roof")>=0)&&(r=colorPicker.floor),(colorPicker.woodMeshes.indexOf(o.source.material.name)>=0||colorPicker.woodMeshes.indexOf(o.source.name)>=0||o.source.name.indexOf("Window")>=0)&&(r=colorPicker.wood),colorPicker.clothMeshes.indexOf(o.source.name)>=0&&(r=colorPicker.cloth),null!=r&&(colorPicker.loops[o.source.material.name]=(colorPicker.loops[o.source.material.name]+1)%r.length,o.source.material.albedoColor=r[colorPicker.loops[o.source.material.name]])}},woodMeshes:["Door_narrow_mesh","CofeeTable","Dresser","Window","DoorFrameC"],clothMeshes:["SofaSmall"],cloth:[new BABYLON.Color3.FromHexString("#ffffff"),new BABYLON.Color3.FromHexString("#aaaaaa"),new BABYLON.Color3.FromHexString("#777777"),new BABYLON.Color3.FromHexString("#444444"),new BABYLON.Color3.FromHexString("#951232"),new BABYLON.Color3.FromHexString("#1a4466"),new BABYLON.Color3.FromHexString("#678b54"),new BABYLON.Color3.FromHexString("#cdce5b"),new BABYLON.Color3.FromHexString("#ce8639"),new BABYLON.Color3.FromHexString("#f1ddc7"),new BABYLON.Color3.FromHexString("#afc5c7"),new BABYLON.Color3.FromHexString("#f9c6e9"),new BABYLON.Color3.FromHexString("#ffffff")],wood:[new BABYLON.Color3.FromHexString("#ffffff"),new BABYLON.Color3.FromHexString("#c78b51"),new BABYLON.Color3.FromHexString("#94602f"),new BABYLON.Color3.FromHexString("#92643d"),new BABYLON.Color3.FromHexString("#5d452c"),new BABYLON.Color3.FromHexString("#7c4d23"),new BABYLON.Color3.FromHexString("#703e14"),new BABYLON.Color3.FromHexString("#ba9f93"),new BABYLON.Color3.FromHexString("#8e4633")],wallColors:[new BABYLON.Color3.FromHexString("#778894"),new BABYLON.Color3.FromHexString("#a0a69b"),new BABYLON.Color3.FromHexString("#f3dbae"),new BABYLON.Color3.FromHexString("#d1d2cf"),new BABYLON.Color3.FromHexString("#6e7a6b"),new BABYLON.Color3.FromHexString("#2d4151"),new BABYLON.Color3.FromHexString("#cbc6bd"),new BABYLON.Color3.FromHexString("#e9e4dd"),new BABYLON.Color3.FromHexString("#887975"),new BABYLON.Color3.FromHexString("#872e3a")],floor:[new BABYLON.Color3.FromHexString("#c2938c"),new BABYLON.Color3.FromHexString("#b96b6d"),new BABYLON.Color3.FromHexString("#867778"),new BABYLON.Color3.FromHexString("#d4b7b0"),new BABYLON.Color3.FromHexString("#eacab7"),new BABYLON.Color3.FromHexString("#a9766e"),new BABYLON.Color3.FromHexString("#cea291"),new BABYLON.Color3.FromHexString("#dcbfa3"),new BABYLON.Color3.FromHexString("#eedabf"),new BABYLON.Color3.FromHexString("#8ea69b"),new BABYLON.Color3.FromHexString("#6d827b"),new BABYLON.Color3.FromHexString("#7f93ac"),new BABYLON.Color3.FromHexString("#6f7071")],colors:[new BABYLON.Color3(1,1,1),new BABYLON.Color3(.5,.5,.5),new BABYLON.Color3(.25,.25,.25)]}})();
var recorrido=(()=>{function e(e){console.log(e.source.name),cameras.currentCameraTarget={position:e.source.position.add(utils.toVector3(cameras.navpointOffset)),rotation:global.cam.rotation,duration:3}}return{reflective:["DoorSlide_mtl","KitchenDevices_mtl","Kitchenware_mtl"],onSceneLoad:function(){sky(),function(){for(var o=0;o<global.scene.meshes.length;o++){var a=global.scene.meshes[o];a.material&&(a.material.backFaceCulling=!1),a.name.indexOf("navpoint")>=0?(utils.registerOnClicMesh(global.scene.meshes[o],e),global.navpoints.push(global.scene.meshes[o]),a.isPickable=!0):(a.isPickable=!0,utils.registerOnClicMesh(global.scene.meshes[o],colorPicker.pickColor),a.material&&recorrido.reflective.indexOf(a.material.name)>=0&&"Kitchen_mtl"!=a.material.name&&(console.log(a.name),a.material.environmentTexture=a.material.reflectionTexture=new BABYLON.CubeTexture("textures/skybox",global.scene)))}global.scene.getMeshByName("navpoint.001")&&(cameras.currentCameraTarget={position:global.scene.getMeshByName("navpoint.001").position.add(utils.toVector3(cameras.navpointOffset)),rotation:global.cam.rotation,duration:3})}(),reflections.setup()},onMouseMove:function(){var e=global.scene.pick(global.scene.pointerX,global.scene.pointerY);e.hit&&console.log(e)}}})();
var reflections={setup:function(){var e=global.scene.getMeshByName("Teapot_LOD1"),r=new BABYLON.StandardMaterial("main",global.scene);e.material=r,global.scene.getMeshByName("KitchenSetA.001").material=r,global.scene.getMeshByName("Refrigerator_LOD0").material=r;for(var n=new BABYLON.ReflectionProbe("main",512,global.scene),a=0;a<reflections.renderInProbe.length;a++)n.renderList.push(global.scene.getMeshByName(reflections.renderInProbe[a]));r.diffuseColor=new BABYLON.Color3(.25,.25,.255),r.reflectionTexture=n.cubeTexture,r.reflectionFresnelParameters=new BABYLON.FresnelParameters,r.reflectionFresnelParameters.bias=.02},renderInProbe:["kitchen walls","Window_wide","KitchenSetA","floor kitchen","roof kitchen"]};
BABYLON.DefaultLoadingScreen.prototype.displayLoadingUI=function(){if(!this._loadingDiv){this._loadingDiv=document.createElement("div"),this._loadingDiv.id="babylonjsLoadingDiv",this._loadingDiv.style.opacity="0",this._loadingDiv.style.transition="opacity 1.5s ease",this._loadingDiv.style.pointerEvents="none";var e=document.createElement("style");e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e);var n=new Image;n.src="scene v4/vreality logo.png",n.style.position="absolute",n.style.left="50%",n.style.top="50%",n.style.animation="spin1 2s infinite ease-in-out",n.style.webkitAnimation="spin1 2s infinite ease-in-out",n.style.transformOrigin="50% 50%",n.style.webkitTransformOrigin="50% 50%",this._loadingDiv.appendChild(n),this._resizeLoadingUI(),window.addEventListener("resize",this._resizeLoadingUI),this._loadingDiv.style.backgroundColor="#ffffff",document.body.appendChild(this._loadingDiv),this._loadingDiv.style.opacity="1"}};var global={engine:null,scene:null,cam:null,navpoints:[]};global.init=(()=>{var e=document.getElementById("renderCanvas"),n=null,i=null,t=function(){return new BABYLON.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0,disableWebGL2Support:!1})};initFunction=async function(){if(!(n=await async function(){try{return t()}catch(e){return console.log("the available createEngine function failed. Creating the default engine instead"),t()}}()))throw"engine should not be null.";global.scene=new BABYLON.Scene(n),BABYLON.SceneLoader.Append("scene v4/babylon bake/","casa.babylon",global.scene,global.init.setup)},initFunction().then(()=>{i=global.scene,n.runRenderLoop(function(){i&&i.activeCamera&&i.render()})});return window.addEventListener("resize",function(){n.resize()}),{setup:function(){var e=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(.8,.8,.8),global.scene);e.intensity=.6,e.diffuse=new BABYLON.Color3(1,1,1),e.specular=new BABYLON.Color3(1,1,1),e.groundColor=new BABYLON.Color3(1,1,1),cameras.setup(),recorrido.onSceneLoad()}}})();
