(() => {var utils={lerp:function(t,e,a){var i=(1-a)*t+a*e,n=Math.max(t,e),o=Math.min(t,e);return Math.max(o,Math.min(n,i))},randomBetween:function(t,e){return(Math.max(t,e)-Math.min(t,e))*Math.random()+Math.min(t,e)},lerpedRange:function(t,e,a){return utils.lerp(t[0][e],t[1][e],a)},randomLerpedRange:function(t,e){return utils.randomBetween(utils.lerpedRange(t,0,e),utils.lerpedRange(t,1,e))}},Box={theBox:null,lastY:0,gimmieBox:function(){var t={markedForSleep:!1,drop:function(){gameStatus.gameOver||(gameStatus.score++,t.sprite.setStatic(!1),gameStatus.emitter.off("update",t.update,t),gameStatus.emitter.on("update",t.gameOverUpdate,t),context.input.off("pointerdown",this.drop,this),t.sprite.setOnCollide(e=>{t.collided||(t.collided=!0,context.dummyFollow.y=Box.theBox.sprite.y-500,Box.lastY=t.sprite.y,Box.gimmieBox().lastBox=this,context.cameras.main.shake(50),gameStatus.emitter.emit("score change"),setTimeout(()=>{t.markedForSleep=!0},2e3))}))}};return t.sprite=context.matter.add.image(Math.random()*(config.width-gameSettings.boxWidth/2)+gameSettings.boxWidth/2,null!==Box.theBox?Box.lastY-800:gameStatus.getBoxSpawnY(),"caja"+(Math.random()>.5?"1":"2")).setFriction(.25,0,.25),t.sprite.setStatic(!0),t.orientation=Math.random()>.5?-1:1,t.update=function(){this.sprite.x+=t.orientation*gameStatus.getXSpeed()*gameStatus.deltaTime,(this.orientation<0&&this.sprite.x<gameSettings.boxWidth/2||this.orientation>0&&this.sprite.x>config.width-gameSettings.boxWidth/2)&&(this.orientation*=-1)},t.gameOverUpdate=function(){this.markedForSleep&&Math.abs(this.sprite.rotation<.27)&&this.sprite.setStatic(!0),this.lastBox&&this.sprite.y>=this.lastBox.sprite.y&&gameStatus.emitter.emit("game over")},gameStatus.emitter.on("update",t.update,t),context.input.on("pointerdown",t.drop,t),this.theBox=t,t}},gameSettings={maxHeight:1e6,tileSize:64,boxHeight:256,floorHeight:264,boxWidth:427,uiDepth:1e3},gameStatus=null;function resetGameStatus(){gameStatus={gameOver:!1,score:0,maxScoreToHardest:10,xSpeed:[540,1080],getXSpeed:function(){return utils.lerp(this.xSpeed[0],this.xSpeed[1],this.score/this.maxScoreToHardest)},getBoxSpawnY:function(){return context.floor.y-gameStatus.score*gameSettings.boxHeight-800}}}var context,images=["gradient","floor","caja1","caja2","background over","tiling sky","game over"],towerGame=new Phaser.Class({Extends:Phaser.Scene,initialize:function(){Phaser.Scene.call(this,{key:"towerGame"})},preload:function(){this.load.setBaseURL("assets");for(var t=0;t<images.length;t++)this.load.image(images[t])},create:function(){resetGameStatus(),gameStatus.emitter=new Phaser.Events.EventEmitter,context=this,UI.create(),UI.isOver=!1,this.floor=this.matter.add.image(config.width/2,gameSettings.maxHeight-gameSettings.floorHeight/2,"floor").setStatic(!0),this.add.image(config.width/2,config.height/2,"background over").setDepth(gameSettings.uiDepth-1).setScrollFactor(0),this.gradient=this.add.image(config.width/2,gameSettings.maxHeight,"gradient").setDepth(-2).setOrigin(.5,1),this.gradient.scaleX=config.width,gameStatus.tilingSky=this.add.tileSprite(config.width/2,config.height,config.width,config.height,"tiling sky").setOrigin(.5,1).setDepth(-1).setScrollFactor(0),this.createCamera(),Box.theBox=null,Box.lastY=0,Box.gimmieBox(),gameStatus.emitter.on("game over",gameOver,this)},update:function(t,e){gameStatus.time=t/1e3,gameStatus.deltaTime=e/1e3,gameStatus.tilingSky.setTilePosition(0,.5*this.cameras.main.scrollY),gameStatus.emitter.emit("update")},createCamera:function(){this.cameras.main.setBounds(0,0,1080,gameSettings.maxHeight),this.cameras.main.setBackgroundColor("#262262"),context.cameras.main.centerOnY(context.floor.y),this.dummyFollow=this.add.image(this.floor.x,this.floor.y),context.cameras.main.startFollow(this.dummyFollow,!1,.1,.1),context.cameras.main.setLerp(1,.01)}});function gameOver(){UI.createGameOver(),gameStatus.gameOver=!0}var config={type:Phaser.AUTO,width:1080,height:1800,physics:{default:"matter",matter:{}},scene:[towerGame]},game=new Phaser.Game(config),UI={isOver:!1,frogCounterLabel:null,updateScore:function(){UI.frogCounterLabel.setText(" x "+gameStatus.score)},normalizedPos:function(t,e){return{x:config.width*t,y:config.height*e}},onOver:function(){UI.isOver=!0,this.originalColor=this.style.backgroundColor,this.style.backgroundColor="#999",this.setStyle(this.style)},onExit:function(){UI.isOver=!1,this.style.backgroundColor=this.originalColor,this.setStyle(this.style)},onAgain:function(){game.scene.start("towerGame")},onRanking:function(){window.open("ranking")},destroyIndication:function(){UI.indication.destroy()},create:function(){UI.frogCounterLabel=context.add.text(192,64," x 0",{fontFamily:"Passion One",fontSize:"64px"}).setOrigin(0,0).setDepth(gameSettings.uiDepth-10).setScrollFactor(0),setTimeout(()=>UI.frogCounterLabel.setStyle(UI.style),1e3),gameStatus.emitter.on("score change",UI.updateScore,UI),UI.indication=context.add.text(config.width/2,400,"¡Toca para comenzar!",{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth-6).setScrollFactor(0),setTimeout(()=>UI.indication.setStyle(UI.indication.style),500),context.input.on("pointerdown",this.destroyIndication,UI)},createGameOver:function(){gameStatus.gameOver||(this.asfadsfasd=context.add.image(config.width/2,config.height/2,"game over").setDepth(gameSettings.uiDepth-1).setScrollFactor(0),UI.createLabel("game over label","¡Sigue intentando!",620,"#f68b1f"),UI.createLabel("score","x "+gameStatus.score,386),UI.createLabel("your ranking","Tu puntaje máximo\n"+backend.getPuntajeMaximo(),1246,null,"48px"),UI.createGameOverButton("again","Jugar de \nNuevo",790,0,UI.onOver,UI.onExit,UI.onAgain),UI.createGameOverButton("ranking","Ver \nRanking",1e3,0,UI.onOver,UI.onExit,UI.onRanking))},createGameOverButton:function(t,e,a,i,n,o,r){UI[t]=context.add.text(context.cameras.main.centerX+i,a,e,{fontFamily:"Passion One",fontSize:"64px",color:"#fff",align:"center",backgroundColor:"#602a7e"}).setOrigin(0==i?.5:Math.sign(i)<0?1:0,.5).setDepth(gameSettings.uiDepth).setPadding(64,16,64,16).setInteractive({useHandCursor:!0}).on("pointerover",n).on("pointerout",o).on("pointerdown",r).setScrollFactor(0)},createLabel:function(t,e,a,i="#602a7e",n="96px"){null===i&&(i="#602a7e"),UI[t]=context.add.text(context.cameras.main.centerX,a,e,{fontFamily:"Passion One",fontSize:n,color:i,align:"center"}).setOrigin(.5,1).setDepth(gameSettings.uiDepth).setScrollFactor(0)}};})();
